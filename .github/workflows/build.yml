name: Build Win32 App

on:
  push:
  pull_request:

permissions:
  contents: write

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Configure CMake
      run: cmake -B build -S . -G "Visual Studio 17 2022" -A x64
    
    - name: Build
      run: cmake --build build --config Release
    
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: win32-app
        path: build/Release/*.exe
    
    - name: Create Release
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ github.run_number }}
        name: Release v${{ github.run_number }}
        files: build/Release/*.exe
        generate_release_notes: true
